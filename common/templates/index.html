<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enxiety Chatbot</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='doraemon.webp') }}">
</head>
<body>
    <div class="header">
        <button onclick="window.location.href='/'" class="home-link">Trang chủ</button>
        <div class="logo-container">
            <span class="how-to-use">Nhấn vô tui để xem hướng dẫn</span>
            <img src="https://static.wixstatic.com/media/d31d8a_802d1ad0b20d443f8676087856dbef5d~mv2.png" alt="Logo" class="logo" onclick="toggleInstructions()">
        </div>    
    </div>
    <div class="content">
        <h1>Tạo quizz cho môn "Quản lý dự án"</h1>
        <div id="chat-container"></div>
        <input type="text" id="user-input" placeholder="Type your message here...">
        <button id="send-button" onclick="sendMessage()">Send</button>
    </div>
    <div id="instructionBox" class="instruction-box">
        <span class="close-btn" onclick="closeInstructions()">&times;</span>
        <h3>How to use Enxiety Chatbot</h3>
        <p><b>With "Search by Topic"</b> <br>You can use type 'topics' to see the list of topics or 'search: [topic's number]: [keyword]' to search for papers with topic or 'search: all: [keyword]' to search for papers with all topics.</p>
        <p><b>With "Search by Gap"</b> <br><b>Step 1.</b> You can type 'gap: [paragraph]' to see the list of gap keywords of the paragraph you provided.
        <br><b>Step 2.</b> Finding the papers that can address the gap keyword you choose. You can use the gap keyword on Step 1. to type 'focus: [gap keyword]' to see the papers that can address that problem.</p>
    </div>
    <script>
        const logo = document.querySelector('.logo');
        const instructionBox = document.getElementById('instructionBox');

        function toggleInstructions() {
            if (instructionBox.style.display === "none" || instructionBox.style.display === "") {
                instructionBox.style.display = "block";
                logo.classList.add('paused');
            } else {
                closeInstructions();
            }
        }

        function closeInstructions() {
            instructionBox.style.display = "none";
            logo.classList.remove('paused');
        }
        function addMessage(sender, message) {
            $('#chat-container').append('<div class="message ' + sender + '">' + message + '</div>');
            $('#chat-container').scrollTop($('#chat-container')[0].scrollHeight);
        }

        function sendMessage() {
            var message = $('#user-input').val();
            if (message.trim() === '') return;

            addMessage('user', message);
            $('#user-input').val('');

            $.ajax({
                url: 'http://127.0.0.1:5000/chat',
                method: 'POST',
                data: { message: message },
                success: function(data) {
                    addMessage('bot', data.response.replace(/\n/g, '<br>'));
                },
                error: function() {
                    addMessage('bot', 'Sorry, there was an error processing your request.');
                }
            });
        }

        $('#user-input').keypress(function(e) {
            if (e.which == 13) {
                sendMessage();
                return false;
            }
        });

        addMessage('bot', "Xin chào! Tôi có thể hỗ trợ bạn tìm câu hỏi trắc nghiệm cho môn học 'Quản lý dự án'. Nhập <code>`chương hỗ trợ`</code> để xem các chương mà tôi đang hỗ trợ sinh câu hỏi");
    </script>
</body>
</html>